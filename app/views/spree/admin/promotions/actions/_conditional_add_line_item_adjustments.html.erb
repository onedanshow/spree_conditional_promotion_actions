<div class="panel-body">
  
  <div class="row">
    <div class="field alpha omega eight columns">
      If the customer's order includes...
    </div>
  </div>

  <div class="row">
    <div class="field alpha four columns products_rule_products">
      <%= label_tag "#{param_prefix}_product_ids_string", Spree.t('add_or_remove_line_item_adjustments_action.choose_product') %>
      <%= hidden_field_tag "#{param_prefix}[preferred_product_id]", promotion_action.preferred_product_id, :class => "product_picker_single fullwidth" %>
    </div>
    <div class="field omega four columns">
      <%= label_tag "#{param_prefix}_quantity_string", Spree.t('add_or_remove_line_item_adjustments_action.quantity') %>
      <%= number_field_tag "#{param_prefix}[preferred_quantity]", promotion_action.preferred_quantity, :min => 1, :class => 'fullwidth' %>
    </div>
  </div>

  <div class="row">
    <div class="field alpha omega eight columns">
      Then apply...
    </div>
  </div>


  <div class="calculator-fields row">

    <div class="field alpha four columns">
      <% field_name = "#{param_prefix}[calculator_type]" %>
      <%= label_tag field_name, Spree.t(:calculator) %>
      <%= select_tag field_name,
                     options_from_collection_for_select(Spree::Promotion::Actions::ConditionalAddLineItemAdjustments.calculators, :to_s, :description, promotion_action.calculator.type),
                     :class => 'type-select select2 fullwidth' %>
      <% if promotion_action.calculator.respond_to?(:preferences) %>
        <span class="warning info"><%= Spree.t(:calculator_settings_warning) %></span>
      <% end %>
    </div>

    <% unless promotion_action.new_record? %>
      <div class="settings field omega four columns">
        <% promotion_action.calculator.preferences.keys.map do |key| %>
          <% field_name = "#{param_prefix}[calculator_attributes][preferred_#{key}]" %>
          <%= label_tag field_name, Spree.t(key.to_s) %>
          <%= preference_field_tag(field_name,
                                   promotion_action.calculator.get_preference(key),
                                   :type => promotion_action.calculator.preference_type(key)) %>
        <% end %>
        <%= hidden_field_tag "#{param_prefix}[calculator_attributes][id]", promotion_action.calculator.id %>
      </div>
    <% end %>
  </div>

</div>